from htmldate import find_date
import pandas as pd

# df = pd.read_csv("all_news.csv")
df = pd.read_csv("diciembre_2024.csv")

faltantes = []
for index, row in df.iterrows():
    try:
        # print(find_date(row["link"]))
        df.at[index, 'fecha'] = find_date(row["link"])
        # df.to_csv("all_news.csv", index=False)
        df.to_csv("diciembre_2024.csv", index=False)
    except:
        faltantes.append(index)
        print(index)
        pass

print(faltantes)


# faltantes = [0, 10, 11, 15, 20, 24, 25, 28, 29, 30, 36, 40, 41, 48, 53, 55, 56, 60, 62, 66, 68, 89, 93, 100, 104, 105, 113, 124, 132, 145, 149, 157, 159, 160, 163, 164, 165, 172, 173, 175, 179, 185, 186, 190, 194, 203, 210, 211, 214, 221, 222, 226, 238, 261, 262, 271, 274, 278, 300, 303, 306, 307, 316, 323, 336, 345, 347, 348, 350, 351, 352, 356, 375, 383, 388, 389, 390, 395, 399, 406, 419, 423, 432, 439, 444, 455, 456, 480, 486, 491, 515, 517, 545, 547, 559, 563, 599, 604, 626, 648, 664, 666, 673, 678, 690, 743, 756, 760, 769, 802, 818, 824, 829, 832, 835, 841, 846, 850, 858, 861, 868, 869, 872, 877, 878, 891, 929, 946, 957, 959, 960, 974, 979, 981, 988, 990, 993, 995, 996, 1007, 1010, 1021, 1023, 1028, 1029, 1049, 1054, 1058, 1062, 1070, 1080, 1089, 1092, 1100, 1120, 1136, 1147, 1151, 1156, 1158, 1169, 1170, 1174, 1175, 1194, 1198, 1200, 1201, 1206, 1211, 1212, 1214, 1215, 1226, 1227, 1239, 1240, 1245, 1251, 1260, 1264, 1269, 1272, 1273, 1274, 1282, 1283, 1284, 1286, 1288, 1291, 1294, 1297, 1314, 1318, 1322, 1326, 1327, 1333, 1336, 1339, 1342, 1355, 1359, 1364, 1368, 1369, 1376, 1383, 1394, 1399, 1400, 1406, 1410, 1416, 1424, 1427, 1443, 1445, 1448, 1451, 1454, 1466, 1475, 1484, 1485, 1487, 1492, 1493, 1498, 1511, 1520, 1522, 1525, 1526, 1531, 1534, 1548, 1560, 1565, 1572, 1573, 1576, 1577, 1578, 1581, 1582, 1586, 1587, 1590, 1593, 1602, 1605, 1618, 1625, 1626, 1630, 1638, 1644, 1645, 1666, 1677, 1686, 1710, 1720, 1722, 1727, 1754, 1759, 1763, 1784, 1799, 1810, 1824, 1841, 1862, 1869, 1905, 1919, 1936, 1946, 1960, 1993, 2030, 2077, 2093, 2134, 2140, 2152, 2161, 2175, 2194, 2196, 2197, 2199, 2201, 2208, 2210, 2234, 2242, 2255, 2266, 2306, 2307, 2333, 2399, 2401, 2403, 2409, 2417, 2430, 2440, 2444, 2448, 2460, 2466, 2471, 2474, 2476, 2477, 2489, 2499, 2518, 2542, 2550, 2556, 2571, 52, 3356, 3366, 3372, 3386, 3413, 3417, 3426, 3437, 3448, 3449, 3454, 3467, 3473, 3475, 3490, 3491, 3492, 3495, 3497, 3505, 3509, 3515, 3518, 3519, 3525, 3531, 3533, 3592, 3603, 3605, 3606, 3609, 3611, 3616, 3619, 3621, 3624, 3629, 3646, 3658, 3678, 3680, 3711, 3731, 3732, 3751, 3760, 3772, 3779, 3780, 3781, 3790, 3796, 3799, 3801, 3805, 3836, 3837, 3853, 3856, 3864, 3868, 3872, 3875, 3877, 3879, 3883, 3920, 3934, 3942, 3946, 3950, 3974, 3977, 3978, 3983, 3989, 4001, 4003, 4004, 4013, 4018, 4021, 4030, 4041, 4051, 4071, 4074, 4086, 4088, 4095, 4103, 4105, 4127, 4132, 4133, 4136, 4138, 4139, 4140, 4141, 4142, 4143, 4147, 4152, 4161, 4162, 4163, 4165, 4168, 4197, 4207, 4209, 4211, 4212, 4214, 4219, 4221, 4222, 4230, 4241, 4248, 4250, 4253, 4259, 4264, 4267, 4275, 4276, 4281, 4283, 4286, 4288, 4290, 4294, 4309, 4315]


import re
import datetime

now = datetime.datetime.now()
nov = now + datetime.timedelta(days=-14)
print(nov.date())

for index, row in df.iterrows():
    if index not in faltantes:
        continue
    numero_mes = re.findall(r'\d+', row["fecha"])
    new_date = nov - datetime.timedelta(days = int(numero_mes[0]) * 30.5)
    df.at[index, 'fecha'] = new_date.date()
    # df.to_csv("all_news.csv", index=False)
    df.to_csv("diciembre_2024.csv", index=False)

